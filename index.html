<!DOCTYPE html>

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Neoastra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/png" href="img/neoastra_fav_icon.png">
  <style type='text/css'>
    ul { list-style: none;padding-left: 0px !important; }

    #recordingslist audio { margin-bottom: 10px; }
    .custom-class{
      color: #00e2ff;
    }

    .neoastra-recorder{
      margin-top: 15vh;
    }
    @media screen and (max-device-width: 480px) and (orientation: portrait) {
      .audio-bar{
        margin-left: 25% !important;
      }
    }
    .bullet::before {
      content: "â€¢"; 
      color: #00e2ff;
      padding-right: 5px;
      width: 1em;
    }
  </style>
   <link href="css/style.css" rel="stylesheet" type="text/css" />
   <link href="css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
   <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />

</head>
<body>

    <div class="loader15 hidden">
        <div></div>
        <div></div>
        <div></div>
        <br/>
        <p>UPLOADING YOUR AUDIO</p>
    </div>

    <div id="particles-js" class="particle"></div>

    <div id="snackbar">Your code copied</div>
    
  <!-- <img src="img/neoastra_logo.png" class="img-responsive"> -->
  <div class="container neoastra-recorder">
      <img src="img/neoastra_logo.png" class="img-responsive" style="position: absolute;width: 32vh;top: 3vh;left: 7vh;">

  <h1 class="custom-class text-center">Please Record "Hey Blue"</h1>
  <!-- <h3 class="custom-class text-center"></h3> -->

  <div class="row">
      <div class="button-container col-md-offset-4 col-md-4" style="text-align: center;">
            <input type="checkbox" id="micButton" class="mic-checkbox">
            <label for="micButton" class="mic-button">
              <div class="mic" onclick="stopRecording();">
                <div class="mic-button-loader">
                </div>
                <!-- <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="512px" height="512px" viewBox="0 0 475.085 475.085" style="width: 40px;height: 94px;enable-background:new 0 0 475.085 475.085;" xml:space="preserve" class=""><g><g>
                        <g>
                          <path d="M237.541,328.897c25.128,0,46.632-8.946,64.523-26.83c17.888-17.884,26.833-39.399,26.833-64.525V91.365    c0-25.126-8.938-46.632-26.833-64.525C284.173,8.951,262.669,0,237.541,0c-25.125,0-46.632,8.951-64.524,26.84    c-17.893,17.89-26.838,39.399-26.838,64.525v146.177c0,25.125,8.949,46.641,26.838,64.525    C190.906,319.951,212.416,328.897,237.541,328.897z" data-original="#000000" class="active-path" data-old_color="#FFFFFF" fill="#FFFFFF"></path>
                          <path d="M396.563,188.15c-3.606-3.617-7.898-5.426-12.847-5.426c-4.944,0-9.226,1.809-12.847,5.426    c-3.613,3.616-5.421,7.898-5.421,12.845v36.547c0,35.214-12.518,65.333-37.548,90.362c-25.022,25.03-55.145,37.545-90.36,37.545    c-35.214,0-65.334-12.515-90.365-37.545c-25.028-25.022-37.541-55.147-37.541-90.362v-36.547c0-4.947-1.809-9.229-5.424-12.845    c-3.617-3.617-7.895-5.426-12.847-5.426c-4.952,0-9.235,1.809-12.85,5.426c-3.618,3.616-5.426,7.898-5.426,12.845v36.547    c0,42.065,14.04,78.659,42.112,109.776c28.073,31.118,62.762,48.961,104.068,53.526v37.691h-73.089    c-4.949,0-9.231,1.811-12.847,5.428c-3.617,3.614-5.426,7.898-5.426,12.847c0,4.941,1.809,9.233,5.426,12.847    c3.616,3.614,7.898,5.428,12.847,5.428h182.719c4.948,0,9.236-1.813,12.847-5.428c3.621-3.613,5.431-7.905,5.431-12.847    c0-4.948-1.81-9.232-5.431-12.847c-3.61-3.617-7.898-5.428-12.847-5.428h-73.08v-37.691    c41.299-4.565,75.985-22.408,104.061-53.526c28.076-31.117,42.12-67.711,42.12-109.776v-36.547    C401.998,196.049,400.185,191.77,396.563,188.15z" data-original="#000000" class="active-path" data-old_color="#FFFFFF" fill="#FFFFFF"></path>
                        </g>
                      </g></g> </svg>
                </div> -->
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="512px" height="512px" viewBox="0 0 401.998 401.998" style="height: 95px;enable-background:new 0 0 401.998 401.998;width: 42px;fill: white;" xml:space="preserve" class=""><g><g>
                    <path d="M377.87,24.126C361.786,8.042,342.417,0,319.769,0H82.227C59.579,0,40.211,8.042,24.125,24.126   C8.044,40.212,0.002,59.576,0.002,82.228v237.543c0,22.647,8.042,42.014,24.123,58.101c16.086,16.085,35.454,24.127,58.102,24.127   h237.542c22.648,0,42.011-8.042,58.102-24.127c16.085-16.087,24.126-35.453,24.126-58.101V82.228   C401.993,59.58,393.951,40.212,377.87,24.126z M365.448,319.771c0,12.559-4.47,23.314-13.415,32.264   c-8.945,8.945-19.698,13.411-32.265,13.411H82.227c-12.563,0-23.317-4.466-32.264-13.411c-8.945-8.949-13.418-19.705-13.418-32.264   V82.228c0-12.562,4.473-23.316,13.418-32.264c8.947-8.946,19.701-13.418,32.264-13.418h237.542   c12.566,0,23.319,4.473,32.265,13.418c8.945,8.947,13.415,19.701,13.415,32.264V319.771L365.448,319.771z" data-original="#000000" class="active-path" data-old_color="#A31515" fill="#A31414" style="
                      fill: #e24b4b;
                  "></path>
                  </g></g> </svg>
              </div>
              <div onclick="startRecording();" class="button-message">
                <!-- <span>
                  PRESS TO TALK
                </span> -->
      
                      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="512px" height="512px" viewBox="0 0 475.085 475.085" style="width: 42px;height: 57px;enable-background:new 0 0 475.085 475.085;" xml:space="preserve" class=""><g><g>
                          <g>
                            <path d="M237.541,328.897c25.128,0,46.632-8.946,64.523-26.83c17.888-17.884,26.833-39.399,26.833-64.525V91.365    c0-25.126-8.938-46.632-26.833-64.525C284.173,8.951,262.669,0,237.541,0c-25.125,0-46.632,8.951-64.524,26.84    c-17.893,17.89-26.838,39.399-26.838,64.525v146.177c0,25.125,8.949,46.641,26.838,64.525    C190.906,319.951,212.416,328.897,237.541,328.897z" data-original="#000000" class="active-path" data-old_color="#FFFFFF" fill="#FFFFFF"></path>
                            <path d="M396.563,188.15c-3.606-3.617-7.898-5.426-12.847-5.426c-4.944,0-9.226,1.809-12.847,5.426    c-3.613,3.616-5.421,7.898-5.421,12.845v36.547c0,35.214-12.518,65.333-37.548,90.362c-25.022,25.03-55.145,37.545-90.36,37.545    c-35.214,0-65.334-12.515-90.365-37.545c-25.028-25.022-37.541-55.147-37.541-90.362v-36.547c0-4.947-1.809-9.229-5.424-12.845    c-3.617-3.617-7.895-5.426-12.847-5.426c-4.952,0-9.235,1.809-12.85,5.426c-3.618,3.616-5.426,7.898-5.426,12.845v36.547    c0,42.065,14.04,78.659,42.112,109.776c28.073,31.118,62.762,48.961,104.068,53.526v37.691h-73.089    c-4.949,0-9.231,1.811-12.847,5.428c-3.617,3.614-5.426,7.898-5.426,12.847c0,4.941,1.809,9.233,5.426,12.847    c3.616,3.614,7.898,5.428,12.847,5.428h182.719c4.948,0,9.236-1.813,12.847-5.428c3.621-3.613,5.431-7.905,5.431-12.847    c0-4.948-1.81-9.232-5.431-12.847c-3.61-3.617-7.898-5.428-12.847-5.428h-73.08v-37.691    c41.299-4.565,75.985-22.408,104.061-53.526c28.076-31.117,42.12-67.711,42.12-109.776v-36.547    C401.998,196.049,400.185,191.77,396.563,188.15z" data-original="#000000" class="active-path" data-old_color="#FFFFFF" fill="#FFFFFF"></path>
                          </g>
                        </g></g> </svg>
      
      
              </div>
            </label>
          </div>
        <div class="col-md-4 col-sm-12 copy-text hidden">
          <input type="text" class="neoastra-text-box text-center" id="myInput">
          <button onclick="myFunction()" class="btn btn-ghost">Copy code</button>
        </div>
    </div>
    
<div class="text-center">
  <!-- <div class="col-md-8"> -->
      <h2 class="custom-class aligns heading-change">Sample Recording</h2>

      <ul class="sample-list">
        <li>
          <div class="row">
          <audio controls="" src="sample-audio.mp3" class="col-md-offset-4 col-md-4" style="margin-bottom: 10px;">
            </audio>
          </div>
        <a href="sample-audio.mp3" download="sample-audio.mp3">sample-audio.mp3</a>
      </li>
      </ul>

      <ul id="recordingslist"></ul>
      
  <!-- </div> -->
  <!-- <div class="col-md-4 hidden">
     
      <pre id="log"></pre>
  </div> -->
</div>
<div class="custom-class">
    <p class="bullet">Record your voice in 10 different ways by saying "hey blue". Listen to the sample above before you begin recording.</p>
    <p class="bullet">After recording, once you press stop button, you will be shown a UNIQUE code,</p>
    <p class="bullet">Please copy the unique code and return to your AMAZON MECHANICAL TURK</p>
    <p class="bullet">Paste the code in the box that says "Enter Unique Code Here"</p>
</div>
<!-- <div style="visibility: hidden">
    <pre id="log"></pre>
</div> -->

  
</div>
  <script src="js/particle.min.js"></script>
  <script>

  particlesJS.load('particles-js', 'js/particlesjs-config.json', function () {});
  // function __log(e, data) {
  //   log.innerHTML += "\n" + e + " " + (data || '');
  // }

 
//  function __log(e, data) {
//     log.innerHTML += "\n" + e + " " + (data || '');
//   }

  var audio_context;
  var recorder;

  function startUserMedia(stream) {
    audio_context = new AudioContext();
    var input = audio_context.createMediaStreamSource(stream);
    // __log('Media stream created.');

    // Uncomment if you want the audio to feedback directly
    //input.connect(audio_context.destination);
    //__log('Input connected to audio context destination.');
    
    recorder = new Recorder(input);
    // __log('Recorder initialised.');
  }

  function startRecording(button) {
    audio_context.resume().then(()=>{
         console.log("Playback resumed successfully.."); 
    });
    $(".copy-text").addClass("hidden")
    recorder && recorder.record();
    // button.disabled = true;
    // button.nextElementSibling.disabled = false;
    // __log('Recording...');
  }

  function stopRecording(button) {
    recorder && recorder.stop();
    // button.disabled = true;
    // button.previousElementSibling.disabled = false;
    // __log('Stopped recording.');
    
    // create WAV download link using audio data blob
    createDownloadLink();
    
    recorder.clear();
  }

  function createDownloadLink() {
    recorder && recorder.exportWAV(function(blob) {
      $(".sample-list").remove()
      $(".heading-change").text("Recordings")
      $(".copy-text").removeClass("hidden");
      
      uploadAudio(blob);
      var url = URL.createObjectURL(blob);
      var div = document.createElement('div')
      div.classList.add('row')
      var li = document.createElement('li');
      var au = document.createElement('audio');
      var hf = document.createElement('a');
      
      
      au.controls = true;
      au.src = url;
      div.appendChild(au)
      hf.href = url;
      hf.download = "Neoastra"+new Date().getTime() + '.mp3';
      $("#myInput").val(hf.download.split(".")[0])
      hf.innerHTML = hf.download;
      li.appendChild(div);
      li.appendChild(hf);
      // recordingslist.appendChild(li);
      $('#recordingslist').html(li)
      
				$("audio").addClass("col-md-4")
        $("audio").addClass("col-md-offset-4")

				$(".custom-class").removeClass("hidden")
    });
  }

function myFunction() {
  var copyText = document.getElementById("myInput");
  copyText.select();
  document.execCommand("copy");
  
  var x = document.getElementById("snackbar")

// Add the "show" class to DIV
x.className = "show";

// After 3 seconds, remove the show class from DIV
setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);

}
	function uploadAudio(mp3Data){
		var reader = new FileReader();
		reader.onload = function(event){
			var fd = new FormData();
			var mp3Name = encodeURIComponent('audio_recording_' + new Date().getTime() + '.mp3');
			// console.log("mp3name = " + mp3Name);
			fd.append('fname', mp3Name);
			fd.append('data', event.target.result);
			$.ajax({
				type: 'POST',
				url: 'upload.php',
				data: fd,
				processData: false,
				contentType: false
			}).done(function(data) {
				//console.log(data);
				// log.innerHTML += "\n" + data;
			});
		};
		reader.readAsDataURL(mp3Data);
  }
  
  window.onload = function init() {
    try {
      // webkit shim
      window.AudioContext = (window.AudioContext || window.webkitAudioContext);
      navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia ||navigator.msGetUserMedia);

      window.URL = window.URL || window.webkitURL;
      
      
      // __log('Audio context set up.');
      // __log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
    } catch (e) {
      alert('No web audio support in this browser!');
    }
    
    navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
      // __log('No live audio input: ' + e);
    });
  };

  </script>

   <script src="js/jquery-1.11.0.min.js"></script>
   <script src="js/recorderWorker.js"></script>
  <!-- <script src="recordmp3.js"></script> -->
</body>
</html>